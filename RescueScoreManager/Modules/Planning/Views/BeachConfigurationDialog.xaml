<Window x:Class="RescueScoreManager.Modules.Planning.Views.BeachConfigurationDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:loc="clr-namespace:RescueScoreManager.Localization"
        xmlns:local="clr-namespace:RescueScoreManager.Modules.Planning.ViewModels"
        Title="Configuration Côtier" Height="600" Width="800"
        WindowStartupLocation="CenterScreen" 
        ResizeMode="CanResize"
        Background="White">

  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    <BooleanToVisibilityConverter x:Key="InvertedBooleanToVisibilityConverter"/>
  </Window.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Header with close button -->
    <TextBlock Grid.Column="0" Text="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Title}" 
                       FontSize="18" FontWeight="Bold" Foreground="#1F2937" VerticalAlignment="Center" Margin="20"/>


    <!-- Main content -->
    <TabControl Grid.Row="1" ItemsSource="{Binding CategoryConfigurations}" SelectedIndex="{Binding SelectedCategoryIndex}" 
                    Background="Transparent" BorderThickness="0" Margin="20">
      <TabControl.ItemContainerStyle>
        <Style TargetType="TabItem">
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="TabItem">
                <Border x:Name="Border" Background="#E5E7EB" CornerRadius="8,8,0,0" Padding="20,10" Margin="0,0,2,0">
                  <ContentPresenter ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                <ControlTemplate.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter TargetName="Border" Property="Background" Value="#2563EB"/>
                  </Trigger>
                </ControlTemplate.Triggers>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </TabControl.ItemContainerStyle>
      <TabControl.ItemTemplate>
        <DataTemplate>
          <TextBlock Text="{Binding Name}" FontWeight="Bold">
            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="#6B7280"/>
                <Style.Triggers>
                  <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=TabItem}}" Value="True">
                    <Setter Property="Foreground" Value="White"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>
          </TextBlock>
        </DataTemplate>
      </TabControl.ItemTemplate>
      <TabControl.ContentTemplate>
        <DataTemplate>
          <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel>
              <!-- Configuration section -->
              <TextBlock Margin="0,20,0,30" FontSize="16" FontWeight="SemiBold">
                <Run Text="{loc:Translate ConfigurationCategorie}"/>
                <Run Text="{Binding DisplayText, Mode=OneWay}"/>
              </TextBlock>

              <!-- Phases section -->
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Phases header -->
                <Grid Grid.Row="0" Margin="0,0,0,20">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                  </Grid.ColumnDefinitions>

                  <TextBlock Grid.Column="0" Text="{loc:Translate PhasesEpreuve}" 
                                               FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"/>

                  <Button Grid.Column="1" Background="#2563EB" Foreground="White" 
                                            BorderThickness="0" Padding="15,8"
                                            Command="{Binding DataContext.AddPhaseCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}">
                    <Button.Template>
                      <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                                        CornerRadius="6" 
                                                        Padding="{TemplateBinding Padding}">
                          <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                      </ControlTemplate>
                    </Button.Template>
                    <StackPanel Orientation="Horizontal">
                      <TextBlock Text="+" FontWeight="Bold" Margin="0,0,8,0"/>
                      <TextBlock Text="{loc:Translate AjouterPhase}"/>
                    </StackPanel>
                  </Button>
                </Grid>

                <!-- Phases List -->
                <ItemsControl Grid.Row="1" ItemsSource="{Binding Phases}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="8" 
                                                    Margin="0,0,0,20" Background="White" Padding="20">
                        <StackPanel>
                          <!-- Phase header -->
                          <DockPanel Margin="0,0,0,20" LastChildFill="True">
                            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                              <Button Content="✕" Background="Transparent" BorderThickness="0"  FontWeight="ExtraBold"
                                                                    Foreground="#EF4444" FontSize="14" Cursor="Hand"
                                                                    Command="{Binding RemoveCommand}" CommandParameter="{Binding}"/>
                            </StackPanel>
                            <TextBlock DockPanel.Dock="Left" Text="{Binding Name}" FontWeight="Bold" 
                                                                   FontSize="14" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            
                          </DockPanel>

                          <!-- Phase form -->
                          <Grid>
                            <Grid.ColumnDefinitions>
                              <ColumnDefinition Width="*"/>
                              <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                              <RowDefinition Height="Auto"/>
                              <RowDefinition Height="Auto"/>
                              <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Order -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,15">
                              <TextBlock Text="{loc:Translate Ordre}" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                              <TextBox Text="{Binding Order}" Background="#F9FAFB" BorderBrush="#E5E7EB" Padding="10"/>
                            </StackPanel>

                            <!-- Level -->
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,0,15">
                              <TextBlock Text="{loc:Translate Niveau}" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                              <ComboBox ItemsSource="{x:Static local:PhaseViewModel.HeatLevelOptions}" 
                                        SelectedValue="{Binding Level}" 
                                        SelectedValuePath="Value"
                                        DisplayMemberPath="DisplayName"
                                        Background="#F9FAFB" BorderBrush="#E5E7EB" Padding="10"/>
                            </StackPanel>

                            <!-- Qualification Logic -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,10,15">
                              <TextBlock Text="{loc:Translate LogiqueQualification}" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                              <ComboBox ItemsSource="{x:Static local:PhaseViewModel.QualificationTypeOptions}" 
                                        SelectedValue="{Binding QualificationLogic}" 
                                        SelectedValuePath="Value"
                                        DisplayMemberPath="DisplayName"
                                        Background="#F9FAFB" BorderBrush="#E5E7EB" Padding="10"/>
                            </StackPanel>

                            <!-- Number of races -->
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="10,0,0,15">
                              <TextBlock Text="{loc:Translate NombreCourse}" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                              <TextBox Text="{Binding NumberOfRaces}" Background="#F9FAFB" BorderBrush="#E5E7EB" Padding="10" PreviewTextInput="NumericTextBox_PreviewTextInput"/>
                            </StackPanel>

                            <!-- Places per race -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,10,0">
                              <TextBlock Text="{loc:Translate NombrePlaceCourse}" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                              <TextBox Text="{Binding PlacesPerRace}" Background="#F9FAFB" BorderBrush="#E5E7EB" Padding="10" PreviewTextInput="NumericTextBox_PreviewTextInput"/>
                            </StackPanel>

                            <!-- Qualifying places -->
                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="10,0,0,0">
                              <TextBlock Text="{loc:Translate NombrePlaceQualificative}" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                              <TextBox Text="{Binding QualifyingPlaces}" Background="#F9FAFB" BorderBrush="#E5E7EB" Padding="10" PreviewTextInput="NumericTextBox_PreviewTextInput"/>
                            </StackPanel>
                          </Grid>
                        </StackPanel>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </Grid>
            </StackPanel>
          </ScrollViewer>
        </DataTemplate>
      </TabControl.ContentTemplate>
    </TabControl>

    <!-- Footer buttons -->
    <Grid Grid.Row="2" Background="#F8F9FA" Margin="20">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <Button Grid.Column="1" Content="Annuler" Background="Transparent" 
                    BorderBrush="#E5E7EB" BorderThickness="1" 
                   Margin="0,0,10,0" Click="CloseButton_Click">
        <Button.Template>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
          </ControlTemplate>
        </Button.Template>
      </Button>

      <Button Grid.Column="2" Content="Sauvegarder" Background="#2563EB" 
                    Foreground="White" BorderThickness="0" Command="{Binding SaveCommand}">
        <Button.Template>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
          </ControlTemplate>
        </Button.Template>
      </Button>
    </Grid>
  </Grid>
</Window>