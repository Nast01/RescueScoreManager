<UserControl x:Class="RescueScoreManager.Modules.Planning.Views.PlanningStructureCompetitionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:loc="clr-namespace:RescueScoreManager.Localization"
             xmlns:viewModels="clr-namespace:RescueScoreManager.Modules.Planning.ViewModels"
             Background="White">
  <UserControl.Resources>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    <DropShadowEffect x:Key="CardShadow" ShadowDepth="2" BlurRadius="8" 
                          Color="#00000020" Direction="270"/>
  </UserControl.Resources>

  <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" 
                CanContentScroll="False">
    <DockPanel LastChildFill="True" Margin="30">
      <!-- Action Buttons -->
      <!--<StackPanel Orientation="Horizontal" Margin="0,0,0,30">
        <Button Background="#F59E0B" Foreground="White" BorderThickness="0" 
                      FontWeight="SemiBold"
                      Command="{Binding NouvelleEpreuveCommand}" Margin="0,0,15,0">
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="+" FontSize="16" FontWeight="Bold" Margin="0,0,8,0"/>
            <TextBlock Text="{loc:Translate NouvelleEpreuve}" FontSize="14"/>
          </StackPanel>
        </Button>

        <Button Background="#EF4444" Foreground="White" BorderThickness="0" 
                      FontWeight="SemiBold"
                      Command="{Binding SaveCommand}">
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="ðŸ’¾" FontSize="14" Margin="0,0,8,0"/>
            <TextBlock Text="{loc:Translate Sauvegarder}" FontSize="14"/>
          </StackPanel>
        </Button>
      </StackPanel>-->

       <!-- Statistics Cards -->
      <Border DockPanel.Dock="Top" Background="#F9FAFB" CornerRadius="12" Margin="0,0,0,30">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <!-- Ã‰preuves Totales -->
          <StackPanel Grid.Column="0" HorizontalAlignment="Center">
            <TextBlock Text="{Binding TotalRaces}" FontSize="32" FontWeight="Bold" 
                                 Foreground="#F59E0B" HorizontalAlignment="Center"/>
            <TextBlock Text="{loc:Translate EpreuvesTotales}" FontSize="14" 
                                 Foreground="#6B7280" HorizontalAlignment="Center"/>
          </StackPanel>

          <!-- ConfigurÃ©es -->
          <StackPanel Grid.Column="1" HorizontalAlignment="Center">
            <TextBlock Text="{Binding ConfiguredEvents}" FontSize="32" FontWeight="Bold" 
                                 Foreground="#10B981" HorizontalAlignment="Center"/>
            <TextBlock Text="{loc:Translate Configurees}" FontSize="14" 
                                 Foreground="#6B7280" HorizontalAlignment="Center"/>
          </StackPanel>

          <!-- Participants -->
          <StackPanel Grid.Column="2" HorizontalAlignment="Center">
            <TextBlock Text="{Binding TotalParticipants}" FontSize="32" FontWeight="Bold" 
                                 Foreground="#8B5CF6" HorizontalAlignment="Center"/>
            <TextBlock Text="{loc:Translate Participants}" FontSize="14" 
                                 Foreground="#6B7280" HorizontalAlignment="Center"/>
          </StackPanel>

          <!-- Progression -->
          <StackPanel Grid.Column="3" HorizontalAlignment="Center">
            <TextBlock Text="{Binding ProgressionPercentage}" FontSize="32" FontWeight="Bold" 
                                 Foreground="#F59E0B" HorizontalAlignment="Center"/>
            <TextBlock Text="{loc:Translate Progression}" FontSize="14" 
                                 Foreground="#6B7280" HorizontalAlignment="Center"/>
          </StackPanel>
        </Grid>
      </Border>
      <!-- RaceCards Grid -->
      <ItemsControl DockPanel.Dock="Bottom" ItemsSource="{Binding RaceCards}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>

        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Background="White" BorderBrush="#E5E7EB" BorderThickness="1" 
                                      CornerRadius="12" Margin="10" Padding="20" Width="350" Height="220"
                                      Effect="{DynamicResource CardShadow}" Cursor="Hand">
              <Border.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding DataContext.OpenRaceConfigurationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" />
              </Border.InputBindings>
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Event Header -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                  </Grid.ColumnDefinitions>

                  <Border Grid.Column="0" Background="{Binding IconColor}" 
                                                  Width="40" Height="40" CornerRadius="8" Margin="0,0,15,0">
                    <TextBlock Text="{Binding Icon}" FontSize="20" 
                                                         HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                         Foreground="White"/>
                  </Border>

                  <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="Bold" 
                                                         Foreground="#1F2937" TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding Type}" FontSize="11" 
                                                         Foreground="#6B7280" Margin="0,2,0,0" TextWrapping="Wrap"/>
                  </StackPanel>

                  <Border Grid.Column="2" Background="{Binding StatusColor}" 
                                                  CornerRadius="6" Padding="8,4">
                    <TextBlock Text="{Binding StatusText}" FontSize="10" 
                                                         FontWeight="Bold" Foreground="White"/>
                  </Border>
                </Grid>

                <!-- Progress Bar -->
                <StackPanel Grid.Row="1" Margin="0,0,0,15">
                  <Grid Margin="0,0,0,5">
                    <TextBlock Text="{loc:Translate Configuration}" FontSize="11" 
                                                         Foreground="#374151" HorizontalAlignment="Left"/>
                    <TextBlock Text="{Binding ProgressText}" FontSize="11" 
                                                         Foreground="#6B7280" HorizontalAlignment="Right"/>
                  </Grid>
                  <ProgressBar Value="{Binding Progress}" Maximum="100" Height="6"
                                                       Background="#E5E7EB" Foreground="#10B981"/>
                </StackPanel>

                <!-- Race Details -->
                <StackPanel Grid.Row="2">
                  <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto"/>
                      <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Rectangle Grid.Column="0" Fill="#3B82F6" Width="12" Height="12" 
                                                         RadiusX="2" RadiusY="2" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" Text="{Binding Schedule}" FontSize="11" 
                                                         Foreground="#374151"/>
                  </Grid>

                  <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto"/>
                      <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Rectangle Grid.Column="0" Fill="#EC4899" Width="12" Height="12" 
                                                         RadiusX="2" RadiusY="2" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" Text="{Binding CategoryDescription}" FontSize="11" 
                                                         Foreground="#374151"/>
                  </Grid>

                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto"/>
                      <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Rectangle Grid.Column="0" Fill="#8B5CF6" Width="12" Height="12" 
                                                         RadiusX="2" RadiusY="2" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" FontSize="11" Foreground="#374151">
                                                  <Run Text="{Binding ParticipantCount}"/>
                                                  <Run Text=" "/>
                                                  <Run Text="{loc:Translate Athletes}"/>
                    </TextBlock>
                  </Grid>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

    </DockPanel>
  </ScrollViewer>
</UserControl>
